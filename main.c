/**
 * $File: main.c
 *
 *  *******************************************************************************************
 *
 *  @file      main.c
 *
 *  @brief     Top level program for the project.
 *  *******************************************************************************************
 *
 *  $NoKeywords
 **/

/**********************************************************************************************
 * Module includes
 **********************************************************************************************/
#include "high_level_funcs.h"
#include "low_level_funcs_tiva.h"
#include "calculate_answer.h"
/**********************************************************************************************
 * Referenced external functions
 **********************************************************************************************/

/**********************************************************************************************
 * Referenced external variables
 **********************************************************************************************/

/**********************************************************************************************
 * Global variable definitions
 **********************************************************************************************/

/**********************************************************************************************
 * Private constant definitions
 **********************************************************************************************/
#define INPUT_BUFFER_SIZE 17

/**********************************************************************************************
 * Private type definitions
 **********************************************************************************************/

/**********************************************************************************************
 * Private function declarations
 **********************************************************************************************/

/**********************************************************************************************
 * Private variable definitions
 **********************************************************************************************/

/**********************************************************************************************
 * Public function definitions
 **********************************************************************************************/
/**
 * @brief   Main function of the project.
 * @param   None.
 * @return  None.
 **/
int
main(void)
{
    double answer = 0.0;
    init_all_hardware();
    answer = read_from_flash();
    DisplayResult(answer);

    while (1)
    {
        char input_buffer[INPUT_BUFFER_SIZE];
        uint8_t  error_ref_no = 0;

        ReadAndEchoInput(input_buffer, INPUT_BUFFER_SIZE);

        /* If the user typed equals immediately (indicated by an empty
         * buffer), we leave the previous answer to be displayed.
         * Otherwise we calculate it. */
        if (input_buffer[0] != '\0')
        {
            answer = CalculateAnswer(input_buffer, INPUT_BUFFER_SIZE, &error_ref_no);
        }

        if (error_ref_no == 0)
        {
            DisplayResult(answer);
            WriteDoubleToFlash(answer);
        }
        else
        {
            DisplayErrorMessage(error_message_line1[error_ref_no], error_message_line2[error_ref_no]);
        }
    }
}

/**********************************************************************************************
 * Private function definitions
 **********************************************************************************************/

/**********************************************************************************************
 * End of file
 **********************************************************************************************/
